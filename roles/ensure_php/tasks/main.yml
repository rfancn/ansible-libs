- name: Check required variables
  fail: msg="Required variables->target_version missed"
  when: target_version is not defined

- name: Check if specific version of PHP is installed or not
  command: php -v
  register: result_php_installed
  ignore_errors: true

- block:
  - include_vars: "{{ target_version }}.yml"
  - include_role: name=ensure_epel
  - include_role: name=ensure_ius_release

  - name: Install specific PHP
    yum: name={{ item }} state=latest
    with_items: "{{ php_package_names }}"
    become: yes

  when: (result_php_installed | failed) or (result_php_installed.stdout.find("{{ target_version }}") == -1)
